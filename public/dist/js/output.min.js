function sendData(a){a.cards.forEach(function(a){delete a.$$hashKey}),webSocket.send(JSON.stringify(a)),masonry.reloadItems(),masonry.layout()}function createWebSocket(){console.log("Attempting to connect..."),webSocket=new WebSocket(host),this.timeoutId=null,webSocket.onopen=function(){console.log("Connected"),clearTimeout(this.timeoutId),ui.updateConnectedUI()},webSocket.onmessage=function(a){var b=JSON.parse(a.data);angular.element("[data-ng-controller=cardController]").scope().parsedJSON=b,angular.element("[data-ng-controller=cardController]").scope().$apply();var c=document.querySelector("#masonry-container");ui.masonry=new Masonry(c,{itemSelector:".masonry-element"}),ui.masonry.reloadItems(),ui.masonry.layout()},webSocket.onclose=function(){ui.updateDisconnectedUI(),this.timeoutId=setTimeout(function(){createWebSocket()},1e4)}}var app=angular.module("cardApp",[]).controller("cardController",["$scope",function(a){a.parsedJSON={},a.addCard=function(){var b=!1;if(a.parsedJSON.cards.forEach(function(c){c.title===a.title&&(b=!0)}),b)alert("Already exists. This card will not be added.");else{var c=a.tags.split(","),d={title:a.title,desc:a.description,tags:c};a.parsedJSON.cards.push(d),angular.element("[data-ng-controller=cardController").scope().$apply(),sendData(a.parsedJSON),$("#add-card-modal").modal("hide")}a.title="",a.description="",a.tags=""},a.removeCard=function(b){var c=a.parsedJSON.cards.indexOf(b);a.parsedJSON.cards.splice(c,1),angular.element("[data-ng-controller=cardController").scope().$apply(),sendData(a.parsedJSON)}}]).directive("card",function(){return{restrict:"E",template:'<div class="panel panel-default"> <div class="panel-heading">{{card.title}}<button type="button" data-ng-click="removeCard(card)" class="remove-card close" disabled="disabled"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button></div><div class="panel-body">{{card.desc}}</div><div class="panel-footer"> <span data-ng-repeat="tag in card.tags track by $index" class="label label-primary">{{tag}}</span></div></div>'}}),webSocket,host=location.origin.replace(/^http/,"ws");$(window).load(function(){ui.updateConnectedUI(),createWebSocket()}),$(window).on("beforeunload",function(){webSocket.close()});var ui={masonry:{},updateConnectedUI:function(){$("#add-card-button").removeAttr("disabled"),$(".remove-card").removeAttr("disabled"),$("#connection-text").html("Connected"),$("#connection-image").show(),$("#disconnection-image").hide()},updateDisconnectedUI:function(){$("#add-card-button").attr("disabled","disabled"),$(".remove-card").attr("disabled","disabled"),$("#connection-text").html("Disconnected"),$("#connection-image").hide(),$("#disconnection-image").show()}};