function sendData(a){a.cards.forEach(function(a){delete a.$$hashKey}),webSocket.send(JSON.stringify(a)),ui.masonry.reloadItems(),ui.masonry.layout()}var app=angular.module("cardApp",[]).controller("cardController",["$scope",function(a){a.newCard={},a.parsedJSON={},a.showCards=!0,a.sorting={},a.sorting.predicate="title",a.sorting.reverse=!1,a.addCard=function(){var b=!1;if(a.parsedJSON.cards.forEach(function(){a.newCard.title===a.title&&(b=!0)}),b)alert("Already exists. This card will not be added.");else{var c=[];("undefined"!=typeof a.newCard.tags||""!==a.newCard.tags)&&(c=a.newCard.tags.split(","));var d={title:a.newCard.title,desc:a.newCard.desc,tags:c};a.parsedJSON.cards.push(d),sendData(a.parsedJSON),$("#add-card-modal").modal("hide")}a.newCard.title="",a.newCard.desc="",a.newCard.tags=""},a.removeCard=function(b){var c=a.parsedJSON.cards.indexOf(b);a.parsedJSON.cards.splice(c,1),sendData(a.parsedJSON)},a.validateForm=function(){"undefined"==typeof a.newCard.title||""===a.newCard.title||"undefined"==typeof a.newCard.desc||""===a.newCard.desc?$("#add-card-submit").attr("disabled","disabled"):$("#add-card-submit").removeAttr("disabled")},a.$watch("newCard.title",function(){a.validateForm()}),a.$watch("newCard.desc",function(){a.validateForm()}),a.reverseSorting=function(){a.showCards=!1,a.$apply(),a.sorting.reverse=!a.sorting.reverse,a.showCards=!0,a.$apply()}}]).directive("card",function(){return{restrict:"E",template:'<div class="panel panel-default"> <div class="panel-heading">{{card.title}}<button type="button" data-ng-click="removeCard(card)" class="remove-card close"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button></div><div class="panel-body">{{card.desc}}</div><div class="panel-footer"> <span data-ng-repeat="tag in card.tags track by $index" class="label label-primary">{{tag}}</span></div></div>'}}),webSocket,host=location.origin.replace(/^http/,"ws");$(window).load(function(){ui.updateConnectedUI(),webSocket=webSocketHandler.createWebSocket()}),$(window).on("beforeunload",function(){webSocket.close()});var ui={masonry:{},updateConnectedUI:function(){$("#add-card-button").removeAttr("disabled"),$(".remove-card").removeAttr("disabled"),$("#connection-text").html("Connected"),$("#connection-image").show(),$("#disconnection-image").hide()},updateDisconnectedUI:function(){$("#add-card-button").attr("disabled","disabled"),$(".remove-card").attr("disabled","disabled"),$("#connection-text").html("Disconnected"),$("#connection-image").hide(),$("#disconnection-image").show()}},webSocketHandler={createWebSocket:function(){console.log("Attempting to connect...");var a=new WebSocket(host);return this.timeoutId=null,a.onopen=function(){console.log("Connected"),clearTimeout(this.timeoutId),ui.updateConnectedUI()},a.onmessage=function(a){var b=JSON.parse(a.data);angular.element("[data-ng-controller=cardController]").scope().parsedJSON=b,angular.element("[data-ng-controller=cardController]").scope().$apply();var c=document.querySelector("#masonry-container");ui.masonry=new Masonry(c,{itemSelector:".masonry-element"}),ui.masonry.reloadItems(),ui.masonry.layout()},a.onclose=function(){ui.updateDisconnectedUI(),this.timeoutId=setTimeout(function(){createWebSocket()},1e4)},a}};